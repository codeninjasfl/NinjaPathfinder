<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Code Ninjas – Ninja Path Finder</title>
  <meta name="theme-color" content="#2563eb" />
  <style>
    :root {
      --bg1:#0ea5e9; --bg2:#2563eb;
      --card:#ffffff; --ink:#0f172a; --muted:#64748b;
      --brand:#2563eb; --border:#e5e7eb;
      --radius:18px;
      --shadow:0 14px 40px rgba(15,23,42,.18);
    }
    * { box-sizing:border-box; }
    html, body {
      margin:0; padding:0; min-height:100%;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"SF Pro Text","Segoe UI",sans-serif;
      background:linear-gradient(180deg,var(--bg1),var(--bg2));
      background-attachment:fixed;
      color:#0f172a;
    }
    .wrap { min-height:100svh; display:grid; place-items:start center; padding:18px; }
    header { color:#eef6ff; text-align:center; margin:4px 0 10px; }
    header .brand { display:flex; align-items:center; justify-content:center; gap:10px; }
    header img.logo { height:40px; width:auto; filter:drop-shadow(0 1px 2px rgba(15,23,42,.4)); }
    header h1 { margin:8px 0 0; font-size:clamp(22px,4vw,32px); font-weight:800; }
    header p { margin:4px 0 0; font-size:13px; color:#dbeafe; }

    .card {
      width:min(900px,98vw);
      background:#fff;
      border-radius:18px;
      padding:20px 20px 18px;
      box-shadow:0 14px 40px rgba(15,23,42,.18);
      border:1px solid rgba(148,163,253,.18);
    }
    .hidden { display:none !important; }

    .prestart-grid {
      display:grid;
      grid-template-columns:repeat(4,minmax(0,1fr));
      gap:10px;
      align-items:center;
      margin-top:6px;
    }
    .prestart-grid input,
    .prestart-grid select {
      padding:11px 12px;
      border-radius:12px;
      border:1px solid #e5e7eb;
      font-size:15px;
      width:100%;
    }
    .prestart-label { font-size:12px; color:#64748b; }
    #startQuizBtn { white-space:nowrap; }

    @media (max-width:720px) {
      .prestart-grid { grid-template-columns:1fr; }
      #startQuizBtn { width:100%; }
      .card { padding:16px 14px 80px; }
    }

    .topbar { display:flex; align-items:center; gap:10px; margin:0 0 14px; }
    .progress { flex:1; height:10px; background:#eef2ff; border-radius:999px; overflow:hidden; }
    .bar { height:100%; width:0; background:linear-gradient(90deg,#2563eb,#22d3ee); transition:width .25s ease; }
    .count { font-size:12px; font-weight:700; color:#334155; min-width:105px; text-align:right; }

    .step { display:none; animation:fade .25s ease; }
    .step.active { display:block; }
    @keyframes fade { from{opacity:0; transform:translateY(4px);} to{opacity:1; transform:none;} }
    @media (prefers-reduced-motion:reduce) { .step { animation:none; } }

    fieldset { border:0; margin:0; padding:0; }
    legend { font-weight:800; margin:0 0 8px; font-size:17px; color:#0f172a; }
    .hint { color:#64748b; font-size:11px; margin:2px 0 4px; }

    .opts {
      display:grid;
      grid-template-columns:repeat(auto-fit,minmax(220px,1fr));
      gap:9px;
    }
    label.opt {
      display:flex;
      align-items:flex-start;
      gap:9px;
      padding:11px;
      border-radius:14px;
      border:1px solid #e5e7eb;
      font-size:14px;
      line-height:1.3;
      cursor:pointer;
      background:#ffffff;
    }
    label.opt:hover {
      box-shadow:0 4px 12px rgba(15,23,42,.07);
      border-color:#cbd5f5;
    }
    label.opt input {
      margin-top:2px;
      accent-color:#2563eb;
      width:18px; height:18px;
    }
    label.opt:focus-within {
      outline:2px solid rgba(37,99,235,.4);
      outline-offset:2px;
    }

    .actions {
      display:flex; justify-content:space-between; gap:8px; margin-top:14px;
    }
    .actions.sticky {
      position:sticky; bottom:calc(env(safe-area-inset-bottom) + 8px);
      padding-top:6px;
      background:linear-gradient(180deg,rgba(255,255,255,0),rgba(255,255,255,.96));
      backdrop-filter:blur(4px) saturate(1.05);
      border-radius:0 0 18px 18px;
    }
    .btn {
      appearance:none; border-radius:12px; padding:10px 15px;
      font-weight:800; font-size:13px; border:1px solid #e5e7eb;
      background:#f8fafc; color:#0f172a; cursor:pointer; min-height:42px;
    }
    .btn.primary { background:#2563eb; color:#ffffff; border-color:#2563eb; }
    .btn:disabled { opacity:.5; cursor:not-allowed; }

    #result { display:none; }
    #personaTitle { text-align:center; margin:0 0 6px; font-size:22px; font-weight:800; }
    #personaBlurb { text-align:center; color:#334155; margin:0 0 10px; font-size:13px; }
    #recTitle { text-align:center; margin:12px 0 4px; font-size:18px; font-weight:800; }
    #recBlurb { text-align:center; color:#334155; margin:0 0 8px; font-size:13px; }
    #recPoints { margin:6px 0 0 20px; padding:0; }
    #recPoints li { margin-bottom:4px; font-size:13px; }

    #funFact { margin-top:10px; padding:10px 11px; border-radius:12px; border:1px dashed #cbd5e1; background:#f8fafc; font-size:12px; }
    #funFact strong { display:block; margin-bottom:2px; }

    #stats { display:grid; grid-template-columns:repeat(auto-fit,minmax(130px,1fr)); gap:9px; margin-top:10px; }
    .stat { padding:10px; border-radius:12px; border:1px solid #e5e7eb; text-align:center; font-size:11px; }
    .stat h3 { margin:0; font-size:17px; font-weight:800; color:#1e293b; }
    .stat p { margin:3px 0 0; color:#6b7280; }

    .center { text-align:center; }
    .hint.center { margin-top:8px; }
    @media (max-width:640px){ .opts{grid-template-columns:1fr;} .actions{flex-wrap:wrap;} .actions .btn.primary{flex:1 0 100%;} }
  </style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="brand">
      <img class="logo" src="https://www.codeninjas.com/hubfs/Group%201.svg" alt="Code Ninjas" onerror="this.style.display='none'">
    </div>
    <h1>Find the Right Path for Your Ninja</h1>
    <p>Answer a few quick questions to match your child with the perfect Code Ninjas program.</p>
  </header>

  <!-- PRE-START -->
  <section id="prestart" class="card" aria-label="Parent details">
    <div class="prestart-label">Start by telling us who you are and which center you're visiting.</div>
    <div class="prestart-grid">
      <input id="parentFirst" placeholder="Parent first name" autocomplete="given-name">
      <input id="parentLast" placeholder="Parent last name" autocomplete="family-name">
      <select id="location" aria-label="Location">
        <option value="">Select location</option>
        <option value="Aventura">Aventura</option>
        <option value="Cooper City">Cooper City</option>
        <option value="Weston">Weston</option>
      </select>
      <button id="startQuizBtn" class="btn primary" type="button" disabled>Start Quiz ▶</button>
    </div>
    <div class="hint">We'll use this to share your child's personalized program match with your chosen center.</div>
  </section>

  <!-- WIZARD -->
  <section id="wizard" class="card hidden" aria-live="polite">
    <div class="topbar" aria-hidden="true">
      <div class="progress"><div id="bar" class="bar"></div></div>
      <div class="count"><span id="qnum">1</span> / <span id="qtotal">1</span> questions</div>
    </div>

    <!-- Q1: Age -->
    <div class="step" data-step-id="q1">
      <fieldset>
        <legend id="ageLegend">How old is your child?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="age" value="5-7"> 5–7</label>
          <label class="opt"><input type="radio" name="age" value="8-10"> 8–10</label>
          <label class="opt"><input type="radio" name="age" value="11-13"> 11–13</label>
          <label class="opt"><input type="radio" name="age" value="14+"> 14+</label>
        </div>
      </fieldset>
    </div>

    <!-- PATH 1: JR (5–7) -->
    <div class="step" data-step-id="q2A" data-show-if="age=5-7">
      <fieldset>
        <legend>Which of these best describe your child? <span class="hint">Choose up to 2</span></legend>
        <div class="opts">
          <label class="opt"><input type="checkbox" name="traits5" value="Curious"> Curious</label>
          <label class="opt"><input type="checkbox" name="traits5" value="Creative"> Creative</label>
          <label class="opt"><input type="checkbox" name="traits5" value="Shy"> Shy</label>
          <label class="opt"><input type="checkbox" name="traits5" value="Energetic"> Energetic</label>
          <label class="opt"><input type="checkbox" name="traits5" value="Observant"> Observant</label>
          <label class="opt"><input type="checkbox" name="traits5" value="Imaginative"> Imaginative</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q3A" data-show-if="age=5-7">
      <fieldset>
        <legend>What kind of play do they enjoy most?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="play5" value="Building"> Building (blocks, Legos, etc.)</label>
          <label class="opt"><input type="radio" name="play5" value="Imaginative"> Imaginative or pretend play</label>
          <label class="opt"><input type="radio" name="play5" value="Games"> Games on a tablet or device</label>
          <label class="opt"><input type="radio" name="play5" value="Arts"> Arts & crafts</label>
          <label class="opt"><input type="radio" name="play5" value="Outdoor"> Outdoor or active play</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q4A" data-show-if="age=5-7">
      <fieldset>
        <legend>When something doesn’t work right away, they usually…</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="grit5" value="Keeps trying"> Keep trying</label>
          <label class="opt"><input type="radio" name="grit5" value="Asks for help"> Ask for help</label>
          <label class="opt"><input type="radio" name="grit5" value="Frustrated"> Get frustrated</label>
          <label class="opt"><input type="radio" name="grit5" value="Move on"> Move on quickly</label>
        </div>
      </fieldset>
    </div>

    <!-- PATH 2: 8–10 -->
    <div class="step" data-step-id="q2B" data-show-if="age=8-10">
      <fieldset>
        <legend>Which traits best describe your child? <span class="hint">Choose up to 2</span></legend>
        <div class="opts">
          <label class="opt"><input type="checkbox" name="traits8" value="Curious"> Curious</label>
          <label class="opt"><input type="checkbox" name="traits8" value="Creative"> Creative</label>
          <label class="opt"><input type="checkbox" name="traits8" value="Competitive"> Competitive</label>
          <label class="opt"><input type="checkbox" name="traits8" value="Social"> Social</label>
          <label class="opt"><input type="checkbox" name="traits8" value="Focused"> Focused</label>
          <label class="opt"><input type="checkbox" name="traits8" value="Distracted"> Easily distracted</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q3B" data-show-if="age=8-10">
      <fieldset>
        <legend>How does your child learn best?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="learn8" value="Hands-on"> Hands-on</label>
          <label class="opt"><input type="radio" name="learn8" value="Visual"> Visual examples</label>
          <label class="opt"><input type="radio" name="learn8" value="Listening"> Listening</label>
          <label class="opt"><input type="radio" name="learn8" value="With friends"> With friends</label>
          <label class="opt"><input type="radio" name="learn8" value="Step-by-step"> Step-by-step instructions</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q4B" data-show-if="age=8-10">
      <fieldset>
        <legend>How do they feel about school and learning?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="school8" value="Loves learning"> Loves learning</label>
          <label class="opt"><input type="radio" name="school8" value="Likes when fun"> Likes it when it’s fun</label>
          <label class="opt"><input type="radio" name="school8" value="Bored"> Gets bored easily</label>
          <label class="opt"><input type="radio" name="school8" value="Struggles focus"> Struggles to stay focused</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q4B-1" data-show-if="school8=Bored,Struggles focus">
      <fieldset>
        <legend>What usually helps them re-engage?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="reengage8" value="Encouragement"> Encouragement from adults</label>
          <label class="opt"><input type="radio" name="reengage8" value="Competition"> Friendly competition</label>
          <label class="opt"><input type="radio" name="reengage8" value="Rewards"> Rewards or milestones</label>
          <label class="opt"><input type="radio" name="reengage8" value="Freedom"> Freedom to do it their way</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q5B" data-show-if="age=8-10">
      <fieldset>
        <legend>How confident are they with technology?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="tech8" value="Beginner"> Beginner</label>
          <label class="opt"><input type="radio" name="tech8" value="Comfortable"> Comfortable</label>
          <label class="opt"><input type="radio" name="tech8" value="Advanced"> Advanced</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q5B-1" data-show-if="tech8=Advanced">
      <fieldset>
        <legend>What have they tried so far?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="tried8" value="Roblox/Minecraft"> Minecraft mods or Roblox Studio</label>
          <label class="opt"><input type="radio" name="tried8" value="Scratch"> Scratch / block coding</label>
          <label class="opt"><input type="radio" name="tried8" value="Robotics"> Robotics kits</label>
          <label class="opt"><input type="radio" name="tried8" value="Interested"> Not yet, but very interested</label>
        </div>
      </fieldset>
    </div>

    <!-- PATH 3: 11–13 -->
    <div class="step" data-step-id="q2C" data-show-if="age=11-13">
      <fieldset>
        <legend>Which traits best describe your child? <span class="hint">Choose up to 2</span></legend>
        <div class="opts">
          <label class="opt"><input type="checkbox" name="traits11" value="Creative"> Creative</label>
          <label class="opt"><input type="checkbox" name="traits11" value="Analytical"> Analytical</label>
          <label class="opt"><input type="checkbox" name="traits11" value="Competitive"> Competitive</label>
          <label class="opt"><input type="checkbox" name="traits11" value="Independent"> Independent</label>
          <label class="opt"><input type="checkbox" name="traits11" value="Team-player"> Team-player</label>
          <label class="opt"><input type="checkbox" name="traits11" value="Curious"> Curious</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q3C" data-show-if="age=11-13">
      <fieldset>
        <legend>When faced with a challenge, they usually…</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="challenge11" value="Persist"> Keep trying</label>
          <label class="opt"><input type="radio" name="challenge11" value="Research"> Research / experiment</label>
          <label class="opt"><input type="radio" name="challenge11" value="Frustrated"> Get frustrated easily</label>
          <label class="opt"><input type="radio" name="challenge11" value="Avoid"> Avoid difficult tasks</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q4C" data-show-if="age=11-13">
      <fieldset>
        <legend>How do they feel about school?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="school11" value="Motivated"> Motivated and focused</label>
          <label class="opt"><input type="radio" name="school11" value="Bored"> Does fine but gets bored</label>
          <label class="opt"><input type="radio" name="school11" value="Struggles"> Struggles to stay focused</label>
          <label class="opt"><input type="radio" name="school11" value="Disengaged"> Disengaged from classes</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q4C-1" data-show-if="school11=Bored,Disengaged">
      <fieldset>
        <legend>What would help them enjoy learning more?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="enjoy11" value="Projects"> Real-world projects</label>
          <label class="opt"><input type="radio" name="enjoy11" value="Freedom"> Freedom to create</label>
          <label class="opt"><input type="radio" name="enjoy11" value="Tech/Games"> Using tech and games</label>
          <label class="opt"><input type="radio" name="enjoy11" value="Peers"> Working with peers</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q5C" data-show-if="age=11-13">
      <fieldset>
        <legend>How comfortable are they with technology?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="tech11" value="Beginner"> Beginner</label>
          <label class="opt"><input type="radio" name="tech11" value="Skilled"> Fairly skilled</label>
          <label class="opt"><input type="radio" name="tech11" value="Advanced"> Advanced (self-driven)</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q5C-1" data-show-if="tech11=Advanced">
      <fieldset>
        <legend>Would they enjoy helping others or leading projects?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="leader11" value="Yes"> Yes</label>
          <label class="opt"><input type="radio" name="leader11" value="Maybe"> Maybe</label>
          <label class="opt"><input type="radio" name="leader11" value="No"> Not right now</label>
        </div>
      </fieldset>
    </div>

    <!-- PATH 4: 14+ -->
    <div class="step" data-step-id="q2D" data-show-if="age=14+">
      <fieldset>
        <legend>What best describes what motivates your teen?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="motivate14" value="Competition"> Competition & clear goals</label>
          <label class="opt"><input type="radio" name="motivate14" value="Recognition"> Recognition & achievements</label>
          <label class="opt"><input type="radio" name="motivate14" value="Curiosity"> Curiosity & learning</label>
          <label class="opt"><input type="radio" name="motivate14" value="Careers"> Preparing for careers</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q3D" data-show-if="age=14+">
      <fieldset>
        <legend>Which areas are they most interested in? <span class="hint">Choose up to 2</span></legend>
        <div class="opts">
          <label class="opt"><input type="checkbox" name="interest14" value="Game dev"> Game development</label>
          <label class="opt"><input type="checkbox" name="interest14" value="Robotics"> Robotics / engineering</label>
          <label class="opt"><input type="checkbox" name="interest14" value="AI"> AI & automation</label>
          <label class="opt"><input type="checkbox" name="interest14" value="Content"> Content creation / design</label>
          <label class="opt"><input type="checkbox" name="interest14" value="Mentor"> Tutoring / mentoring younger students</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q4D" data-show-if="age=14+">
      <fieldset>
        <legend>How confident are they with technology?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="tech14" value="Beginner"> Beginner</label>
          <label class="opt"><input type="radio" name="tech14" value="Intermediate"> Intermediate</label>
          <label class="opt"><input type="radio" name="tech14" value="Advanced"> Advanced</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q4D-1" data-show-if="tech14=Advanced">
      <fieldset>
        <legend>Are they interested in tech certifications or careers?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="career14" value="Yes"> Yes</label>
          <label class="opt"><input type="radio" name="career14" value="Somewhat"> Somewhat</label>
          <label class="opt"><input type="radio" name="career14" value="Not yet"> Not yet</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q5D" data-show-if="age=14+">
      <fieldset>
        <legend>Which growth area is most important this year?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="growth14" value="Leadership"> Leadership</label>
          <label class="opt"><input type="radio" name="growth14" value="Time management"> Time management</label>
          <label class="opt"><input type="radio" name="growth14" value="Collaboration"> Collaboration</label>
          <label class="opt"><input type="radio" name="growth14" value="Creativity"> Creativity</label>
        </div>
      </fieldset>
    </div>

    <!-- SHARED GOALS -->
    <div class="step" data-step-id="q13">
      <fieldset>
        <legend>What are you hoping your child gains from Code Ninjas? <span class="hint">Select all that apply</span></legend>
        <div class="opts">
          <label class="opt"><input type="checkbox" name="goals" value="Confidence"> Confidence & self-belief</label>
          <label class="opt"><input type="checkbox" name="goals" value="Focus"> Focus & discipline</label>
          <label class="opt"><input type="checkbox" name="goals" value="Teamwork"> Teamwork & communication</label>
          <label class="opt"><input type="checkbox" name="goals" value="Academic"> Academic advantage</label>
          <label class="opt"><input type="checkbox" name="goals" value="Creativity"> Creativity & innovation</label>
          <label class="opt"><input type="checkbox" name="goals" value="Future skills"> Future skills (coding, AI, robotics)</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="qFuture" data-show-if="age=8-10,11-13">
      <fieldset>
        <legend>If we focused your Ninja’s time on future-ready skills, which feels most important this year?</legend>
        <div class="opts">
          <label class="opt">
            <input type="radio" name="futurefocus" value="Coding core">
            A strong foundation in coding first (consistency & mastery).
          </label>
          <label class="opt">
            <input type="radio" name="futurefocus" value="Coding + AI">
            Coding plus early exposure to AI and smart tools.
          </label>
          <label class="opt">
            <input type="radio" name="futurefocus" value="Coding + Robotics">
            Coding plus hands-on robotics & engineering challenges.
          </label>
          <label class="opt">
            <input type="radio" name="futurefocus" value="All three">
            A blend of coding, AI, and robotics throughout the year.
          </label>
          <label class="opt">
            <input type="radio" name="futurefocus" value="Not sure">
            I’m not sure yet — I mostly want them excited, confident, and moving forward.
          </label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q15">
      <fieldset>
        <legend>What inspired you to visit Code Ninjas today?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="visit" value="Referral"> Friend or school referral</label>
          <label class="opt"><input type="radio" name="visit" value="Online"> Social media / online</label>
          <label class="opt"><input type="radio" name="visit" value="After-school"> Exploring after-school options</label>
          <label class="opt"><input type="radio" name="visit" value="Camps"> Interested in camps</label>
          <label class="opt"><input type="radio" name="visit" value="Coding/AI"> Curious about coding/AI</label>
          <label class="opt"><input type="radio" name="visit" value="Other"> Other</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q16">
      <fieldset>
        <legend>How important is it for kids to understand AI & emerging technology?</legend>
        <div class="opts">
          <label class="opt"><input type="radio" name="ai" value="Essential"> Essential</label>
          <label class="opt"><input type="radio" name="ai" value="Very"> Very important</label>
          <label class="opt"><input type="radio" name="ai" value="Somewhat"> Somewhat important</label>
          <label class="opt"><input type="radio" name="ai" value="Not sure"> Not sure yet</label>
        </div>
      </fieldset>
    </div>

    <div class="step" data-step-id="q17">
      <fieldset>
        <legend>Which traits would you most like to see grow this year? <span class="hint">Choose up to 2</span></legend>
        <div class="opts">
          <label class="opt"><input type="checkbox" name="traitsGrow" value="Confidence"> Confidence</label>
          <label class="opt"><input type="checkbox" name="traitsGrow" value="Focus"> Focus</label>
          <label class="opt"><input type="checkbox" name="traitsGrow" value="Creativity"> Creativity</label>
          <label class="opt"><input type="checkbox" name="traitsGrow" value="Leadership"> Leadership</label>
          <label class="opt"><input type="checkbox" name="traitsGrow" value="Collaboration"> Collaboration</label>
          <label class="opt"><input type="checkbox" name="traitsGrow" value="Resilience"> Resilience</label>
        </div>
      </fieldset>
    </div>

    <div class="actions sticky">
      <button class="btn" id="backBtn" type="button">◀ Back</button>
      <button class="btn primary" id="nextBtn" type="button">Next ▶</button>
    </div>
  </section>

  <!-- RESULT VIEW -->
  <section id="result" class="card" aria-live="polite">
    <h2 id="personaTitle"></h2>
    <p id="personaBlurb"></p>
    <h2 id="recTitle"></h2>
    <p id="recBlurb"></p>
    <ul id="recPoints"></ul>

    <div id="funFact" class="hidden">
      <strong>Fun Fact for Your Ninja!</strong>
      <div id="funFactText"></div>
    </div>

    <h3 class="center" style="margin:14px 0 4px;">At-a-glance match</h3>
    <div id="stats"></div>

    <div class="actions center" style="justify-content:center; margin-top:14px;">
      <button class="btn" id="retakeBtn" type="button">Retake Quiz</button>
    </div>
    <p class="hint center" id="centerNote"></p>
  </section>
</div>

<!-- Web3Forms form (hidden; includes required fields) -->
<form id="web3Form" class="hidden" action="https://api.web3forms.com/submit" method="POST" novalidate>
  <input type="hidden" name="access_key" value="fa23863b-372c-4f44-b8e4-dd8f0ec3b087">

  <!-- Keep name (center uses it); avoid duplicate by NOT adding it again in message body -->
  <input type="hidden" id="wf_name"   name="name"  value="">
  <textarea name="message" id="wf_message" style="display:none;"></textarea>

  <!-- Optional helpers for the center -->
  <input type="hidden" id="wf_subject" name="subject" value="New Ninja Path Finder Lead">
  <input type="hidden" name="from_name" value="Code Ninjas Program Finder">
</form>

<script>
(function(){
  const $  = (s,root=document) => root.querySelector(s);
  const $$ = (s,root=document) => Array.from(root.querySelectorAll(s));
  window.API_Access = true; // set to false to skip Web3Forms submit

  // ---------- PRESTART ----------
  const prestart = $('#prestart');
  const startBtn = $('#startQuizBtn');
  const inputsPre = {
    parentFirst: $('#parentFirst'),
    parentLast:  $('#parentLast'),
    location:    $('#location')
  };
  let parentFirst = '', parentLast = '', centerLocation = '';

  function syncStartState(){
    parentFirst    = (inputsPre.parentFirst.value || '').trim();
    parentLast     = (inputsPre.parentLast.value  || '').trim();
    centerLocation = (inputsPre.location.value    || '').trim();
    startBtn.disabled = !(parentFirst && parentLast && centerLocation);
  }
  Object.values(inputsPre).forEach(el => {
    el.addEventListener('input', syncStartState);
    el.addEventListener('change', syncStartState);
  });

  // ---------- WIZARD STATE ----------
  const wizard = $('#wizard');
  const bar = $('#bar');
  const qnum = $('#qnum');
  const qtotalSpan = $('#qtotal');
  const backBtn = $('#backBtn');
  const nextBtn = $('#nextBtn');
  const result = $('#result');
  const allSteps = $$('.step');
  let visibleSteps = [];
  let idx = 0;

  function parseCondition(cond){
    if(!cond) return null;
    const [name, values] = cond.split('=');
    if(!name || !values) return null;
    const allowed = values.split(',').map(v => v.trim());
    return { name: name.trim(), values: allowed };
  }

  function getValue(name){
    const radios = $$('input[type=radio][name="'+name+'"]');
    if(radios.length){
      const checked = radios.find(r => r.checked);
      return checked ? checked.value : '';
    }
    const checks = $$('input[type=checkbox][name="'+name+'"]:checked');
    if(checks.length){
      return checks.map(c => c.value);
    }
    return '';
  }

  function conditionMatches(cond){
    const c = parseCondition(cond);
    if(!c) return true;
    const val = getValue(c.name);
    if(Array.isArray(val)){
      return val.some(v => c.values.includes(v));
    }
    return c.values.includes(val);
  }

  function recomputeVisibleSteps(){
    visibleSteps = allSteps.filter(step => {
      const cond = step.getAttribute('data-show-if');
      if(!cond) return true;
      return conditionMatches(cond);
    });
    visibleSteps.forEach(s => s.classList.remove('active'));
    if(idx >= visibleSteps.length) idx = visibleSteps.length - 1;
    if(idx < 0) idx = 0;
    updateUI();
  }

  function updateUI(){
    visibleSteps.forEach((s,i) => s.classList.toggle('active', i === idx));
    const total = visibleSteps.length || 1;
    qtotalSpan.textContent = total;
    qnum.textContent = idx + 1;
    bar.style.width = (idx / Math.max(total - 1, 1)) * 100 + '%';
    backBtn.disabled = idx === 0;

    const active = visibleSteps[idx];
    let disableNext = false;
    if(active){
      const radios = $$('input[type=radio]', active);
      if(radios.length){
        const names = [...new Set(radios.map(r => r.name))];
        names.forEach(name => {
          const group = $$('input[type=radio][name="'+name+'"]', active);
          if(group.length && !group.some(r => r.checked)){
            disableNext = true;
          }
        });
      }
    }
    nextBtn.textContent = (idx === visibleSteps.length - 1) ? 'See Results ▶' : 'Next ▶';
    nextBtn.disabled = disableNext;
  }

  wizard.addEventListener('change', recomputeVisibleSteps);
  visibleSteps = allSteps; updateUI();

  // ---------- START QUIZ ----------
  startBtn.addEventListener('click', () => {
    syncStartState();
    if(!(parentFirst && parentLast && centerLocation)) return;
    prestart.classList.add('hidden');
    wizard.classList.remove('hidden');
    idx = 0;
    recomputeVisibleSteps();
    const ageLegend = $('#ageLegend');
    if(ageLegend){
      ageLegend.textContent = `Hi ${parentFirst}! How old is your child?`;
    }
  });

  // ---------- NAV ----------
  $('#backBtn').addEventListener('click', () => { if(idx>0){ idx--; updateUI(); } });
  $('#nextBtn').addEventListener('click', () => {
    if(idx < visibleSteps.length - 1){ idx++; updateUI(); }
    else { computeResultsAndSubmit(); }
  });

  // ---------- LABEL HELPERS ----------
  function radioLabel(name){
    const el = document.querySelector('input[name="'+name+'"]:checked');
    if(!el) return '';
    const lab = el.closest('label');
    return lab ? lab.textContent.trim() : el.value;
  }
  function checkboxLabels(name){
    return Array.from(document.querySelectorAll('input[name="'+name+'"]:checked')).map(el => {
      const lab = el.closest('label');
      return lab ? lab.textContent.trim() : el.value;
    });
  }
  function getLegendForInputName(name){
    const input = document.querySelector('[name="'+name+'"]');
    if(!input) return '';
    const fs = input.closest('fieldset');
    if(!fs) return '';
    const legend = fs.querySelector('legend');
    if(!legend) return '';
    const clone = legend.cloneNode(true);
    clone.querySelectorAll('span').forEach(s => s.remove());
    return clone.textContent.trim();
  }

  // ---------- PROGRAM SELECTION ----------
  function baseProgramKey(age){
    if(age === '5-7') return 'JR';
    if(age === '8-10' || age === '11-13') return 'CREATE';
    if(age === '14+') return 'ACADEMY';
    return 'CREATE';
  }

  function chooseCreateBundle(){
    const future = getValue('futurefocus');
    const goals = checkboxLabels('goals');
    const tech8 = getValue('tech8');
    const tech11 = getValue('tech11');

    if(future === 'All three'){
      return { label:'1+1+1 Bundle', type:'1+1+1' };
    }
    if(future === 'Coding + AI'){
      return { label:'1+1 Bundle (CREATE + AI Academy)', type:'1+1_AI' };
    }
    if(future === 'Coding + Robotics'){
      return { label:'1+1 Bundle (CREATE + Robotics Academy)', type:'1+1_Robotics' };
    }
    if(future === 'Coding core'){
      return { label:'2x/Week', type:'2x' };
    }
    if(future === 'Not sure'){
      if(goals.includes('Future skills') || tech8 === 'Advanced' || tech11 === 'Advanced'){
        return { label:'1+1 Bundle (CREATE + AI Academy)', type:'1+1_AI' };
      }
      return { label:'2x/Week', type:'2x' };
    }
    if(goals.includes('Future skills') || tech8 === 'Advanced' || tech11 === 'Advanced'){
      return { label:'1+1 Bundle (CREATE + AI Academy)', type:'1+1_AI' };
    }
    return { label:'2x/Week', type:'2x' };
  }

  // Paragraph-length, bundle-specific Ninja profiles
  function personaBlurbByBundle(ageKey, bundleType){
    if(ageKey === 'JR'){
      return "Your Ninja thrives when learning feels like play. In Code Ninjas JR we channel big imagination into bite-sized wins—story-driven activities, hands-on tinkering, and gentle challenges that grow confidence without overwhelm. As they build patterns, sequences, and early problem-solving habits, mentors cheer them on so trying again feels natural and fun. It’s the perfect launchpad for curiosity to become capability.";
    }
    if(ageKey === 'ACADEMY'){
      return "Your Ninja is hungry for real challenges and real outcomes. In Academy, they’ll take on portfolio-ready projects, explore AI and modern development tools, and learn to plan, iterate, and ship—just like pros do. With mentors who coach mindsets as much as mechanics, they’ll build independence, leadership, and the kind of confidence that shows up in school, interviews, and beyond. It’s serious growth without losing the joy.";
    }
    if(bundleType === '2x'){
      return "Your Ninja is ready to lock in focused momentum. With CREATE 2x, we double down on coding only—steady weekly rhythm, clear milestones, and mentor feedback that compounds. This path builds real fluency: reading code, fixing bugs, and finishing games that actually work. The consistency keeps motivation high while the belt system turns progress into something they can see and be proud of.";
    }
    if(bundleType === '1+1_AI'){
      return "Your Ninja loves building—and they’re curious about the smart tools shaping the world. The CREATE 1+1 (CREATE + AI Academy) bundle blends solid coding foundations with age-appropriate AI concepts, from problem-solving with intelligent helpers to designing projects that feel a little bit magical. Mentors keep it safe, understandable, and exciting, so curiosity becomes capability and big ideas feel within reach.";
    }
    if(bundleType === '1+1_Robotics'){
      return "Your Ninja wants to see code come to life. The CREATE 1+1 (CREATE + Robotics Academy) bundle pairs core coding progress with hands-on engineering—sensors, motion, and builds they can hold. They’ll learn to plan, test, and iterate while celebrating every wobbly prototype that gets a little better. It’s a confidence-boosting mix of logic and making that turns tinkering into real skills.";
    }
    if(bundleType === '1+1+1'){
      return "Your Ninja thrives on variety and momentum. The CREATE 1+1+1 bundle layers coding with rotating academy and club experiences, so each week feels fresh while skills stack up. They’ll deepen fundamentals, sample AI and robotics, and plug into a community that celebrates progress. It’s the all-around path for kids who want to explore widely, grow steadily, and stay excited all year long.";
    }
    return "Your Ninja likes to build, tinker, and see progress fast. In CREATE, mentors guide them through projects that make coding feel rewarding, not intimidating—so they keep going even when challenges pop up. They’ll level up through our belt system, learn to debug with confidence, and finish creations they’re proud to share. It’s structured, fun, and designed for real growth.";
  }

  function buildProgramUI(age){
    const key = baseProgramKey(age);

    if(key === 'JR'){
      return {
        uiTitle: 'Recommended Program: Code Ninjas JR',
        uiBlurb: 'Playful, story-driven sessions where young Ninjas (5–7) explore early coding, logic, and creativity with tons of encouragement.',
        bullets: [
          'Gentle, game-based introduction to core concepts',
          'Hands-on projects that feel like play, not like school',
          'Builds early confidence, focus, and curiosity'
        ],
        stats: [
          ['5–7', 'Ideal ages'],
          ['Play-based', 'Learning style'],
          ['2–3 hrs / week', 'Recommended time'],
          ['Small groups', 'Mentor support'],
          ['Early logic', 'Patterns & sequencing'],
          ['Fun & safe', 'Dojo environment']
        ],
        apiProgram: 'Code Ninjas JR',
        bundleType: null
      };
    }

    if(key === 'ACADEMY'){
      return {
        uiTitle: 'Recommended Program: Code Ninjas Academy',
        uiBlurb: 'A deeper track for motivated teens ready for real-world coding, AI, and engineering projects that look great on future applications.',
        bullets: [
          'Project-based learning in coding, AI, and tech',
          'Portfolio-style outcomes for schools & careers',
          'A community of like-minded, driven Ninjas'
        ],
        stats: [
          ['14+', 'Typical ages'],
          ['Advanced', 'Challenge level'],
          ['2–3 hrs / week', 'Recommended time'],
          ['Real projects', 'Portfolio-ready'],
          ['Mentorship', 'Guided growth'],
          ['Future-focused', 'College & career skills']
        ],
        apiProgram: 'Code Ninjas Academy',
        bundleType: null
      };
    }

    // CREATE with bundles
    const bundle = chooseCreateBundle();

    // Base stats
    let stats = [
      ['8–13', 'Ideal ages'],
      ['Belt system', 'Built-in motivation'],
      ['3–4 hrs / week', 'Recommended time'], // default; override below
      ['Game creation', 'High engagement'],
      ['Future skills', 'Coding & logic'],
      ['Mentor support', 'Guided progress']
    ];

    let variantLine = '';
    let bulletsExtra = [];

    if(bundle.type === '2x'){
      variantLine = ' Code Ninjas CREATE (2x/Week)';
      stats[2] = ['3–4 hrs / week', 'Recommended time'];
      bulletsExtra = [
        'Two focused CREATE sessions each week for consistent progress',
        'Locked in on coding fundamentals—no additional academies or clubs',
        'Perfect when you want depth and mastery in one powerful track'
      ];
    } else if(bundle.type === '1+1_AI'){
      variantLine = ' Code Ninjas CREATE (1+1 Bundle: CREATE + AI Academy)';
      stats[2] = ['2–3 hrs / week', 'Recommended time']; // per request
      bulletsExtra = [
        'One CREATE session + one AI Academy session each week',
        'Blend core coding with age-appropriate AI concepts and tools',
        'Great for future-facing Ninjas curious about smart technology'
      ];
    } else if(bundle.type === '1+1_Robotics'){
      variantLine = ' Code Ninjas CREATE (1+1 Bundle: CREATE + Robotics Academy)';
      stats[2] = ['2–3 hrs / week', 'Recommended time']; // per request
      bulletsExtra = [
        'One CREATE session + one Robotics Academy session each week',
        'Turn code into motion with engineering challenges and builds',
        'Ideal for hands-on builders who love to see things move'
      ];
    } else if(bundle.type === '1+1+1'){
      variantLine = ' Code Ninjas CREATE (1+1+1 Bundle: Coding + Academies + Clubs)';
      stats[2] = ['3–4 hrs / week', 'Recommended time']; // three combined
      const baseThree = [
        'Structured path from block coding into real languages',
        'Mentor-led dojo that feels fun, not like more school',
        'Builds confidence, focus, and perseverance through challenges'
      ];
      const extraForTriple = [
        'Coding',
        'Rotating AI and Robotics Academy experiences across the year',
        'Clubs/community add variety and momentum for hungry learners'
      ];
      return {
        uiTitle: 'Recommended Program:' + variantLine,
        uiBlurb: 'Your Ninja is ready for our CREATE Dojo—where they build real games, sharpen problem-solving, and level up through our belt system in a space that feels like home.',
        bullets: [...baseThree, ...extraForTriple],
        stats,
        apiProgram: 'Code Ninjas CREATE',
        bundleType: bundle.type
      };
    }

    return {
      uiTitle: 'Recommended Program:' + variantLine,
      uiBlurb: 'Your Ninja is ready for our CREATE Dojo—where they build real games, sharpen problem-solving, and level up through our belt system in a space that feels like home.',
      bullets: [
        'Structured path from block coding into real languages',
        'Mentor-led dojo that feels fun, not like more school',
        'Builds confidence, focus, and perseverance through challenges',
        ...bulletsExtra
      ],
      stats,
      apiProgram: 'Code Ninjas CREATE',
      bundleType: bundle.type
    };
  }

  // ---------- FUN FACT ----------
  function funFactText(programKey, signals){
    const txt = signals.join(' ').toLowerCase();
    if(/game|roblox|minecraft/.test(txt)){
      return 'Designing and coding their own games strengthens logic, creativity, and persistence—the same problem-solving muscles used by professional developers.';
    }
    if(/robot/.test(txt)){
      return 'Building and programming robots helps kids connect coding to the real world, which research links to higher engagement in STEM over time.';
    }
    if(programKey === 'ACADEMY' || /ai\b/.test(txt)){
      return 'Students who engage early with coding and AI concepts gain confidence navigating technologies that are shaping the fastest-growing careers.';
    }
    return 'Learning to code builds problem-solving, creativity, and resilience—skills that support success in math, science, writing, and beyond.';
  }

  // ---------- Q&A SUMMARY ----------
  function buildQASummary(){
    const fields = [
      ['age','radio'],
      ['traits5','checkbox'],['play5','radio'],['grit5','radio'],
      ['traits8','checkbox'],['learn8','radio'],['school8','radio'],['reengage8','radio'],['tech8','radio'],['tried8','radio'],
      ['traits11','checkbox'],['challenge11','radio'],['school11','radio'],['enjoy11','radio'],['tech11','radio'],['leader11','radio'],
      ['motivate14','radio'],['interest14','checkbox'],['tech14','radio'],['career14','radio'],['growth14','radio'],
      ['goals','checkbox'],['futurefocus','radio'],['visit','radio'],['ai','radio'],['traitsGrow','checkbox'],['proud','radio']
    ];
    const lines = [];
    fields.forEach(([name,type]) => {
      const legend = getLegendForInputName(name);
      if(!legend) return;
      let ans = (type === 'radio')
        ? radioLabel(name)
        : checkboxLabels(name).join(', ');
      if(ans) lines.push(legend + ' → ' + ans);
    });
    return lines;
  }

  // ---------- Tone helpers (email) ----------
  function craftTraitLine(traits){
    const t = (traits || []).map(v => v.toLowerCase());
    if(t.includes('competitive')) return "Your Ninja’s competitive streak will feel right at home in our dojo—friendly challenges keep them engaged while they learn to win the right way: by improving their work.";
    if(t.includes('focused') || t.includes('analytical')) return "That steady, analytical way of thinking is a real advantage here; we’ll channel it into planning, testing, and finishing projects they’re proud of.";
    if(t.includes('curious')) return "Curiosity is rocket fuel at Code Ninjas—mentors turn those “what if?” moments into experiments and real breakthroughs.";
    if(t.includes('creative')) return "A creative eye goes a long way here; we encourage original ideas, design choices, and storytelling inside each build.";
    if(t.includes('team-player') || t.includes('social') || t.includes('collaboration')) return "They’ll fit into our collaborative dojo culture, where pair-problem-solving and sharing progress are part of the rhythm.";
    if(t.includes('independent')) return "We’ll respect that independent streak and teach them how to scope work, ask smart questions, and ship finished projects.";
    return "";
  }

  function craftGoalsLines(goals){
    const g = (goals || []).map(v => v.toLowerCase());
    const lines = [];
    if(g.includes('focus')) lines.push("You mentioned focus and discipline. That’s top of mind for many families right now. In a world designed for short bursts of attention, we slow things down just enough to build habits—planning, debugging, and finishing—without losing the fun.");
    if(g.includes('teamwork')) lines.push("You care about teamwork and communication. Our dojo is built around collaboration and peer feedback, so kids learn to explain ideas and celebrate wins together.");
    if(g.includes('creativity')) lines.push("Creativity isn’t an afterthought here; it’s baked in. From game design to robotics builds, we make space for choices and personal style.");
    if(g.includes('confidence')) lines.push("If confidence is the goal, we’ll stack small wins. Belts, badges, and finished projects make progress visible—and kids start to trust themselves with harder challenges.");
    if(g.includes('academic')) lines.push("Looking for an academic edge? Coding quietly supports math, reading, and problem-solving—skills that transfer back to schoolwork.");
    if(g.includes('future skills')) lines.push("You’re thinking ahead about future skills. We introduce AI, automation, and real-world tech thoughtfully, so kids learn how to use powerful tools responsibly.");
    return lines.join("\n");
  }

  // ---------- FOLLOW-UP EMAIL (for center, in API only) ----------
  function buildFollowupEmail(apiProgramName, personaLabel, funFact, bundleType){
    const greeting = parentFirst || 'there';
    const goals = checkboxLabels('goals').map(s => s.split('&')[0].trim()); // normalize
    const future = radioLabel('futurefocus');

    const traits = []
      .concat(checkboxLabels('traits5'))
      .concat(checkboxLabels('traits8'))
      .concat(checkboxLabels('traits11'));

    // Program display with bundle included when applicable
    let programDisplay = apiProgramName;
    if(apiProgramName === 'Code Ninjas CREATE'){
      if(bundleType === '1+1_AI') programDisplay += ' (1+1 Bundle: CREATE + AI Academy)';
      else if(bundleType === '1+1_Robotics') programDisplay += ' (1+1 Bundle: CREATE + Robotics Academy)';
      else if(bundleType === '1+1+1') programDisplay += ' (1+1+1 Bundle: Coding + Academies + Clubs)';
      else if(bundleType === '2x') programDisplay += ' (2x/Week)';
    }

    const traitLine = craftTraitLine(traits);
    const goalsLines = craftGoalsLines(goals);

    const futureLine = (future && future !== 'Not sure')
      ? "Your priorities around future-ready skills line up well with this track."
      : "";

    const funFactLine = funFact ? `\nA quick insight we shared today:\n${funFact}\n` : '';

    // One “Thank you”, remove “Social media / online” mention, no bold/asterisks
    return (
`Hi ${greeting},

Thanks for stopping by Code Ninjas ${centerLocation} today. Based on what you shared, your child is a strong fit for ${programDisplay}.

${traitLine ? traitLine + "\n" : ""}${goalsLines ? goalsLines + "\n" : ""}${futureLine ? futureLine + "\n" : ""}${funFactLine}Next steps are simple:
• Stop by the front desk and we’ll walk you through getting started, or
• Call anytime and we’ll help you enroll and answer questions.

As a thank-you for visiting, you can use code C9J5 to waive the enrollment fee if you enroll in the next few days.

We’re excited to help your Ninja get started.

Best,
[Center Director Name]
Center Director, Code Ninjas ${centerLocation}`
    );
  }

  // ---------- SMS SAMPLE TEMPLATES (for center, in API only) ----------
  function buildSmsSamples(programDisplay){
    return [
`Hi ${parentFirst || ''}, Code Ninjas ${centerLocation} here! We recommended ${programDisplay} for your Ninja. We’d love to lock in their spot so they can keep that momentum going. You can drop in anytime we’re open, or start here: [RECOMMENDED_PROGRAM_LINK]`,

`Hey ${parentFirst || ''}, thanks for visiting Code Ninjas ${centerLocation}! Based on what you shared, ${programDisplay} will keep your Ninja challenged (and having fun). If you have questions, reply here or stop by and we’ll help you get set up.`,

`Hi ${parentFirst || ''}, quick note from Code Ninjas ${centerLocation}. If you’re ready, you can enroll in ${programDisplay} and use code C9J5 in the next 48 hours to waive the enrollment fee. No pressure—drop in anytime we’re open or tap: [RECOMMENDED_PROGRAM_LINK]`
    ].join('\n\n');
  }

  // ---------- API SUBMIT ----------
  function submitToWeb3Forms(message){
    if(window.API_Access === false){ console.log('API submission skipped'); return; }
    const form = $('#web3Form');
    const msgField = $('#wf_message');
    const subjField = $('#wf_subject');
    const nameField = $('#wf_name');
    if(!form || !msgField || !subjField || !nameField) return;

    subjField.value = `New Ninja Path Finder Lead - ${centerLocation}`;
    nameField.value = `${parentFirst} ${parentLast}`.trim();
    msgField.value = message;

    const fd = new FormData(form);
    fetch(form.action, { method:'POST', body:fd })
      .then(r => r.json())
      .then(d => console.log('Web3Forms success', d))
      .catch(err => console.warn('Web3Forms error', err));
  }

  // ---------- MAIN RESULTS ----------
  function computeResultsAndSubmit(){
    const ageVal = getValue('age') || '';
    const baseKey = baseProgramKey(ageVal);
    const programUI = buildProgramUI(ageVal);

    // Persona title
    const goals = checkboxLabels('goals');
    const allTraits = []
      .concat(checkboxLabels('traits5'))
      .concat(checkboxLabels('traits8'))
      .concat(checkboxLabels('traits11'))
      .concat(checkboxLabels('interest14'));
    let persona = 'The Curious Creator Ninja';
    if(goals.includes('Confidence')) persona = 'The Confidence-Boosting Ninja';
    else if(goals.includes('Future skills')) persona = 'The Future-Ready Ninja';
    else if(allTraits.some(t => /Game/i.test(t))) persona = 'The Game Maker Ninja';
    else if(allTraits.some(t => /Robotics|Engineering/i.test(t))) persona = 'The Builder Ninja';

    const bundleType = programUI.bundleType || (baseKey === 'CREATE' ? (chooseCreateBundle().type) : null);
    const personaBlurb = personaBlurbByBundle(baseKey, bundleType);

    // UI
    $('#personaTitle').textContent = `Your Ninja Profile: ${persona}`;
    $('#personaBlurb').textContent = personaBlurb;

    $('#recTitle').textContent = programUI.uiTitle;
    $('#recBlurb').textContent = programUI.uiBlurb;
    $('#recPoints').innerHTML = programUI.bullets.map(b => `<li>${b}</li>`).join('');

    $('#stats').innerHTML = programUI.stats.map(([v,l]) => `<div class="stat"><h3>${v}</h3><p>${l}</p></div>`).join('');

    // Fun fact
    const signals = [].concat(allTraits, goals, [
      radioLabel('play5'), radioLabel('tried8'), radioLabel('futurefocus'), radioLabel('ai')
    ].filter(Boolean));
    const funFact = funFactText(baseKey, signals);

    if(funFact){ $('#funFactText').textContent = funFact; $('#funFact').classList.remove('hidden'); }
    else { $('#funFact').classList.add('hidden'); }

    // Center note
    $('#centerNote').textContent =
      `Before you head out today, stop by the front desk at Code Ninjas ${centerLocation} so we can walk you through this path and help you enroll. A summary of your results has been shared with the center.`;

    // Email/SMS content with improved tone and bundle naming
    const apiProgramName = programUI.apiProgram;

    // Build a programDisplay for SMS (same rules as email)
    let programDisplay = apiProgramName;
    if(apiProgramName === 'Code Ninjas CREATE'){
      if(bundleType === '1+1_AI') programDisplay += ' (1+1 Bundle: CREATE + AI Academy)';
      else if(bundleType === '1+1_Robotics') programDisplay += ' (1+1 Bundle: CREATE + Robotics Academy)';
      else if(bundleType === '1+1+1') programDisplay += ' (1+1+1 Bundle: Coding + Academies + Clubs)';
      else if(bundleType === '2x') programDisplay += ' (2x/Week)';
    }

    const followupEmail = buildFollowupEmail(apiProgramName, persona, funFact, bundleType);
    const smsSamples = buildSmsSamples(programDisplay);

    const timestamp = new Date().toLocaleString();

    // IMPORTANT: do not repeat parent name here (the form already has it)
    const qaSummary = buildQASummary();

    const message =
`Location: Code Ninjas ${centerLocation}
Submitted: ${timestamp}

Recommended Program: ${programDisplay}
Persona Label: ${persona}

Q&A Summary:
${qaSummary.map(l => '• ' + l).join('\n')}

Fun Fact shown to parent:
${funFact || ''}

Follow-up Email Template (copy and send):
${followupEmail}

Sample Next-Day SMS Messages (internal use, choose/adapt one):
${smsSamples}
`;

    submitToWeb3Forms(message);

    // Show result
    wizard.classList.add('hidden');
    result.style.display = 'block';
    window.scrollTo({ top:0, behavior:'smooth' });
  }

  // ---------- RETAKE ----------
  $('#retakeBtn').addEventListener('click', () => { window.location.reload(); });
})();
</script>
</body>
</html>
