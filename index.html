<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Code Ninjas – Program Finder</title>
  <meta name="theme-color" content="#2563eb" />
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="apple-mobile-web-app-title" content="CN Program Finder">
  <link rel="apple-touch-icon" href="apple-touch-icon.png">
  <style>
    :root{ --bg1:#0ea5e9; --bg2:#2563eb; --card:#fff; --ink:#0f172a; --muted:#64748b; --brand:#2563eb; --border:#e5e7eb; --radius:16px; --shadow:0 12px 30px rgba(2,6,23,.18), 0 2px 8px rgba(2,6,23,.08);} 
    *{box-sizing:border-box}
    html,body{margin:0;min-height:100%;background:linear-gradient(180deg,var(--bg1),var(--bg2));background-repeat:no-repeat;background-attachment:fixed;background-size:cover;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans;color:var(--ink)}
    .wrap{min-height:100svh;display:grid;place-items:start center;padding:20px}
    header{color:#eef6ff;text-align:center;margin-bottom:12px}
    header .brand{display:flex;align-items:center;justify-content:center}
    header img.logo{height:40px;width:auto;filter:drop-shadow(0 1px 0 rgba(0,0,0,.15))}
    header h1{margin:10px 0 0;font-size:clamp(22px,4vw,34px)}
    .card{width:min(860px,96vw);background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:22px}
    .hidden{display:none !important}
    .topbar{display:flex;align-items:center;gap:10px;margin:4px 0 14px}
    .progress{flex:1;height:12px;background:#eef2ff;border-radius:999px;overflow:hidden}
    .bar{height:100%;width:0;background:linear-gradient(90deg,var(--brand),#22d3ee)}
    .count{font-weight:800;color:#334155;min-width:110px;text-align:right}
    .step{display:none;animation:fade .25s ease}
    .step.active{display:block}
    @keyframes fade{from{opacity:0;transform:translateY(4px)}to{opacity:1;transform:none}}
    @media (prefers-reduced-motion:reduce){.step{animation:none}}
    fieldset{border:0;margin:0;padding:0}
    legend{font-weight:900;margin:0 0 10px;font-size:18px}
    .hint{color:var(--muted);font-size:12px;margin-left:6px}
    .opts{display:grid;grid-template-columns:repeat(auto-fit,minmax(260px,1fr));gap:12px}
    label.opt{display:flex;align-items:center;gap:12px;padding:16px;border:1px solid var(--border);border-radius:14px;cursor:pointer;user-select:none;line-height:1.25;min-height:56px;font-size:16px}
    label.opt:focus-within{outline:3px solid color-mix(in oklab,var(--brand) 65%, white)}
    input[type=radio],input[type=checkbox]{accent-color:var(--brand)}
    .actions{display:flex;gap:10px;justify-content:space-between;margin-top:14px}
    .actions.sticky{position:sticky;bottom:calc(env(safe-area-inset-bottom) + 8px);background:linear-gradient(180deg,rgba(255,255,255,0),rgba(255,255,255,.92));backdrop-filter:saturate(1.2) blur(4px);padding-top:6px;border-bottom-left-radius:var(--radius);border-bottom-right-radius:var(--radius)}
    .btn{appearance:none;border:1px solid var(--border);background:#f8fafc;border-radius:12px;padding:12px 16px;cursor:pointer;font-weight:900;min-height:48px}
    .btn.primary{background:var(--brand);border-color:var(--brand);color:#fff}
    .btn:focus-visible{outline:3px solid color-mix(in oklab,var(--brand) 65%, white)}
    .btn:disabled{opacity:.5;cursor:not-allowed}
    #result{display:none}
    #personaTitle{text-align:center;margin:0 0 6px}
    #personaBlurb{text-align:center;color:#334155;margin:0 0 12px}
    #recTitle{text-align:center;margin:0 0 4px}
    #recBlurb{text-align:center;color:#334155;margin:0 0 10px}
    #recPoints{margin:8px 0 0 18px}
    #stats{display:grid;grid-template-columns:repeat(2,1fr);gap:10px;margin-top:12px}
    .stat{border:1px solid var(--border);border-radius:12px;padding:14px;text-align:center}
    .stat h3{margin:0;font-size:24px}
    .stat p{margin:6px 0 0;color:#475569;font-size:13px}
    #funFact{margin-top:14px;padding:12px;border:1px dashed #cbd5e1;border-radius:12px;background:#f8fafc}
    #funFact strong{display:block;margin-bottom:4px}
    #funFact a.learn-link{font-weight:700;text-decoration:underline}
    @media (max-width:640px){.wrap{padding:14px}.card{padding:14px}#stats{grid-template-columns:1fr}.count{min-width:84px}.actions{flex-wrap:wrap}.actions .btn.primary{flex:1 0 100%}.actions .btn:not(.primary){flex:0 0 auto}.opts{grid-template-columns:1fr}header img.logo{height:34px}}
    .center{ text-align:center; }
    #result{ padding:26px 24px; }
    #result h2{ margin:0 0 10px; line-height:1.2 }
    #personaBlurb{ margin:8px 0 20px; }
    #recTitle{ margin-top:14px; }
    #recBlurb{ margin-bottom:12px; }
    #recPoints{ margin:12px 0 18px 22px; }
    #result hr{ margin:18px 0; border:0; border-top:1px solid var(--border); }
    #stats{ margin-top:16px; gap:12px; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <img class="logo" src="https://www.codeninjas.com/hubfs/Group%201.svg" alt="Code Ninjas logo" onerror="this.style.display='none'">
      </div>
      <h1>Find the right program for your Ninja!</h1>
    </header>

    <!-- Pre-start: Parent name + Location -->
    <section class="card" id="prestart" aria-label="Director setup" autocomplete="off">
      <label class="hint" for="parentFirstNameTop">Parent's name</label>
      <div style="display:grid;grid-template-columns:1fr 1fr 1fr auto;gap:8px;align-items:center">
        <input id="parentFirstNameTop" placeholder="First name" autocomplete="off" autocapitalize="words" style="padding:12px;border:1px solid var(--border);border-radius:12px;font-size:16px" />
        <input id="parentLastNameTop" placeholder="Last name" autocomplete="off" autocapitalize="words" style="padding:12px;border:1px solid var(--border);border-radius:12px;font-size:16px" />
        <select id="centerLocationTop" required style="padding:12px;border:1px solid var(--border);border-radius:12px;font-size:16px;background:#fff">
          <option value="" selected disabled>Select location</option>
          <option value="Aventura">Aventura</option>
          <option value="Cooper City">Cooper City</option>
          <option value="Weston">Weston</option>
        </select>
        <button class="btn primary" id="startQuizBtn" type="button" disabled>Start quiz ▶</button>
      </div>
    </section>

    <!-- WIZARD -->
    <section id="wizard" class="card hidden" aria-live="polite">
      <div class="topbar" aria-hidden="true">
        <div class="progress" aria-hidden="true"><div class="bar" id="bar"></div></div>
        <div class="count"><span id="qnum">1</span>/<span id="qtotal">8</span></div>
      </div>

      <!-- Step 1 -->
      <div class="step active" data-step="0">
        <fieldset>
          <legend id="ageLegend">How old is your child?</legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="age" value="5-7" required> 5–7</label>
            <label class="opt"><input type="radio" name="age" value="8-10"> 8–10</label>
            <label class="opt"><input type="radio" name="age" value="11-14"> 11–14</label>
            <label class="opt"><input type="radio" name="age" value="15+"> 15+</label>
          </div>
        </fieldset>
      </div>

      <!-- Step 2 -->
      <div class="step" data-step="1">
        <fieldset>
          <legend>What is your child's prior experience with coding? <span class="hint">Scale: 1–5</span></legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="experience" value="1" required> 1 — Brand new</label>
            <label class="opt"><input type="radio" name="experience" value="2"> 2 — Beginner</label>
            <label class="opt"><input type="radio" name="experience" value="3"> 3 — Some exposure</label>
            <label class="opt"><input type="radio" name="experience" value="4"> 4 — Experienced</label>
            <label class="opt"><input type="radio" name="experience" value="5"> 5 — Very experienced</label>
          </div>
        </fieldset>
      </div>

      <!-- Step 3 -->
      <div class="step" data-step="2">
        <fieldset>
          <legend>How comfortable is your child with technology? <span class="hint">Scale: 1–5</span></legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="comfort" value="1" required> 1 — Still learning</label>
            <label class="opt"><input type="radio" name="comfort" value="2"> 2 — Getting the hang of it</label>
            <label class="opt"><input type="radio" name="comfort" value="3"> 3 — Pretty comfortable</label>
            <label class="opt"><input type="radio" name="comfort" value="4"> 4 — Confident</label>
            <label class="opt"><input type="radio" name="comfort" value="5"> 5 — Very confident</label>
          </div>
        </fieldset>
      </div>

      <!-- Step 4 -->
      <div class="step" data-step="3" data-require-one="interests">
        <fieldset>
          <legend>Which activities interest your child the most? <span class="hint">Select all that apply</span></legend>
          <div class="opts">
            <label class="opt"><input type="checkbox" name="interests" value="GameDev">Building video games</label>
            <label class="opt"><input type="checkbox" name="interests" value="RobloxMinecraft">Roblox or Minecraft</label>
            <label class="opt"><input type="checkbox" name="interests" value="Robotics">Robotics</label>
            <label class="opt"><input type="checkbox" name="interests" value="3D">3D design/printing</label>
            <label class="opt"><input type="checkbox" name="interests" value="AI">Artificial Intelligence</label>
          </div>
          <p class="hint require-msg" aria-live="polite" style="display:none">Select at least one option to continue.</p>
        </fieldset>
      </div>

      <!-- Step 5 (omitted) -->
      <div class="step-omitted hidden" data-step="4"></div>

      <!-- Step 6 -->
      <div class="step" data-step="5">
        <fieldset>
          <legend>How does your child learn best?</legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="learn" value="Hands-on" required>Hands-on activities</label>
            <label class="opt"><input type="radio" name="learn" value="Step-by-step">Step-by-step instructions</label>
            <label class="opt"><input type="radio" name="learn" value="Independent">Independent exploration</label>
            <label class="opt"><input type="radio" name="learn" value="Mentor">Working with a mentor</label>
          </div>
        </fieldset>
      </div>

      <!-- Step 7 -->
      <div class="step" data-step="6" data-require-one="hopes">
        <fieldset>
          <legend>What are you hoping your child will gain from Code Ninjas? <span class="hint">Select all that apply</span></legend>
          <div class="opts">
            <label class="opt"><input type="checkbox" name="hopes" value="Fun">Fun & confidence</label>
            <label class="opt"><input type="checkbox" name="hopes" value="NewSkills">New coding/tech skills</label>
            <label class="opt"><input type="checkbox" name="hopes" value="Academic">Academic enrichment</label>
            <label class="opt"><input type="checkbox" name="hopes" value="LongTerm">Long-term STEM development</label>
          </div>
          <p class="hint require-msg" aria-live="polite" style="display:none">Select at least one option to continue.</p>
        </fieldset>
      </div>

      <!-- Step 8 -->
      <div class="step" data-step="7">
        <fieldset>
          <legend>Which format will your child enjoy more?</legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="structure" value="Structured" required>Structured curriculum</label>
            <label class="opt"><input type="radio" name="structure" value="Clubs">Creative, club-style</label>
            <label class="opt"><input type="radio" name="structure" value="Either">Either / mix</label>
          </div>
        </fieldset>
      </div>

      <!-- Step 9 -->
      <div class="step" data-step="8">
        <fieldset>
          <legend>What inspired you to visit Code Ninjas today?</legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="visitReason" value="FutureReady" required> Coding is the future, and I want to prepare my child</label>
            <label class="opt"><input type="radio" name="visitReason" value="AIChange"> AI is changing everything too fast — I want my child ready</label>
            <label class="opt"><input type="radio" name="visitReason" value="LovesGamesTech"> I want to leverage my child's love for tech.</label>
            <label class="opt"><input type="radio" name="visitReason" value="NeedsConfidenceFocus"> My child needs to be challenged.</label>
            <label class="opt"><input type="radio" name="visitReason" value="FriendshipsLikeminded"> I want my child to build friendships with likeminded kids.</label>
            <label class="opt"><input type="radio" name="visitReason" value="Exploring"> We’re just exploring</label>
          </div>
        </fieldset>
      </div>

      <!-- Step 10 -->
      <div class="step" data-step="9">
        <fieldset>
          <legend>How does your child usually feel about school and learning?</legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="schoolFeeling" value="LovesLearning" required> Loves to learn and stays engaged</label>
            <label class="opt"><input type="radio" name="schoolFeeling" value="LikesSome"> Enjoys some subjects but not others</label>
            <label class="opt"><input type="radio" name="schoolFeeling" value="GetsBored"> Gets bored with "easy subjects."</label>
            <label class="opt"><input type="radio" name="schoolFeeling" value="StrugglesConfidence"> Struggles to stay confident or focused</label>
          </div>
        </fieldset>
      </div>

      <!-- Step 11 (AI importance) -->
      <div class="step" data-step="16">
        <fieldset>
          <legend>How important is it for kids to understand AI and emerging technology now?</legend>
          <div class="opts">
            <label class="opt"><input type="radio" name="aiImportance" value="VeryEssential" required> Very — it’s essential for their future</label>
            <label class="opt"><input type="radio" name="aiImportance" value="SomewhatComing"> Somewhat — I know it’s coming fast</label>
            <label class="opt"><input type="radio" name="aiImportance" value="NotSureYet"> AI has no place in childrens curriculum.</label>
          </div>
        </fieldset>
      </div>

      <div class="actions sticky">
        <button class="btn" id="backBtn" type="button">◀ Back</button>
        <button class="btn primary" id="nextBtn" type="button">Next ▶</button>
      </div>
    </section>

    <!-- RESULTS -->
    <section id="result" class="card" aria-live="polite">
      <h2 id="personaTitle"></h2>
      <p id="personaBlurb"></p>
      <h2 id="recTitle"></h2>
      <p id="recBlurb"></p>
      <ul id="recPoints"></ul>
      <hr>
      <div id="funFact" class="hidden">
        <strong>Fun Fact!</strong>
        <div id="funFactText"></div>
      </div>
      <h3 class="center" style="margin:0 0 8px">At-a-glance stats</h3>
      <div id="stats"></div>
      <div class="actions center" style="justify-content:center;margin-top:12px">
        <button class="btn" id="retake">Retake quiz</button>
        <button class="btn" id="print">Print/Save</button>
      </div>
      <p class="hint center" style="margin-top:10px">Program availability and features can vary by location.</p>
    </section>
  </div>

  <!-- Hidden Web3Forms form (we POST via fetch to avoid redirect) -->
  <form id="web3formsForm" action="https://api.web3forms.com/submit" method="POST" class="hidden" aria-hidden="true" novalidate>
    <input type="hidden" name="access_key" value="fa23863b-372c-4f44-b8e4-dd8f0ec3b087">
    <input type="hidden" name="subject" value="New Ninja Path">
    <input type="hidden" name="from_name" value="Code Ninjas Quiz">
    <input type="hidden" name="redirect" value="https://codeninjasfl.github.io/NinjaPathfinder/">
    <textarea name="message" id="wf_message" style="display:none"></textarea>
  </form>

  <script>
  (function(){
    const $ = (sel,root)=> (root||document).querySelector(sel);
    const $$ = (sel,root)=> Array.from((root||document).querySelectorAll(sel));

    let _parentFirst = '', _parentLast = '', _location = '';
    function setParentFirst(n){ _parentFirst = String(n||'').trim(); }
    function setParentLast(n){ _parentLast = String(n||'').trim(); }
    function setLocation(l){ _location = String(l||'').trim(); }
    function getFirstName(){ return _parentFirst; }
    function getLastName(){ return _parentLast; }
    function getLocation(){ return _location; }

    const prestart = $('#prestart');
    const parentFirstInput = $('#parentFirstNameTop');
    const parentLastInput  = $('#parentLastNameTop');
    const parentLocationSelect = $('#centerLocationTop');
    const startBtn = $('#startQuizBtn');

    const wizard = $('#wizard');
    const steps = $$('.step');
    const total = steps.length; $('#qtotal').textContent = total;
    const bar = $('#bar'); const qnum = $('#qnum');
    const backBtn = $('#backBtn'); const nextBtn = $('#nextBtn');
    const result = $('#result');

    const wfForm = $('#web3formsForm');
    let submittedToWeb3 = false;

    function syncStartUI(){
      prestart.classList.remove('hidden');
      wizard.classList.add('hidden');
      if(parentFirstInput){ parentFirstInput.value=''; parentFirstInput.focus(); }
      if(parentLastInput){ parentLastInput.value=''; }
      if(parentLocationSelect){ parentLocationSelect.selectedIndex = 0; }
      if(startBtn){ startBtn.disabled = true; }
    }

    if(parentFirstInput && parentLastInput){
      const updateStartDisabled = ()=>{
        const f = (parentFirstInput.value||'').trim();
        const l = (parentLastInput.value||'').trim();
        const loc = ((parentLocationSelect && parentLocationSelect.value) || '').trim();
        startBtn.disabled = !(f && l && loc);
      };
      parentFirstInput.addEventListener('input', updateStartDisabled);
      parentLastInput .addEventListener('input', updateStartDisabled);
      if(parentLocationSelect){ parentLocationSelect.addEventListener('change', updateStartDisabled); }
      parentFirstInput.addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); startBtn.click(); }});
      parentLastInput .addEventListener('keydown', (e)=>{ if(e.key==='Enter'){ e.preventDefault(); startBtn.click(); }});
    }

    if(startBtn){
      startBtn.addEventListener('click', ()=>{
        const first = String(parentFirstInput.value||'').trim();
        const last  = String(parentLastInput.value ||'').trim();
        const loc   = String((parentLocationSelect && parentLocationSelect.value) || '').trim();
        if(!first || !last || !loc) return;
        setParentFirst(first); setParentLast(last); setLocation(loc);
        prestart.classList.add('hidden');
        wizard.classList.remove('hidden');
        idx = 0; updateUI();
      });
    }

    let idx = 0;
    function updateUI(){
      steps.forEach((s,i)=> s.classList.toggle('active', i===idx));
      qnum.textContent = idx+1;
      bar.style.width = (idx/(total-1))*100 + '%';
      backBtn.disabled = idx===0;

      const ageLegendEl = $('#ageLegend');
      if(ageLegendEl){
        if(idx===0){ const fn = getFirstName(); ageLegendEl.textContent = fn ? `Hi ${fn}! Before we begin, how old is your child?` : `How old is your child?`; }
        else { ageLegendEl.textContent = `How old is your child?`; }
      }

      let disableNext = false;
      const active = steps[idx];
      const requiredRadio = active.querySelector('input[type=radio][required]');
      if(requiredRadio){ const group = requiredRadio.name; const selected = wizard.querySelector(`input[name="${group}"]:checked`); disableNext = !selected; }
      const requireOne = active.getAttribute('data-require-one');
      if(requireOne){ const anyChecked = !!wizard.querySelector(`input[name="${requireOne}"]:checked`); disableNext = disableNext || !anyChecked; const msg = active.querySelector('.require-msg'); if(msg){ msg.style.display = anyChecked ? 'none':'block'; } }
      nextBtn.disabled = disableNext; nextBtn.textContent = idx===total-1 ? 'See results ▶' : 'Next ▶';
    }

    wizard.addEventListener('change', updateUI);
    wizard.addEventListener('input', updateUI);
    backBtn.addEventListener('click', ()=>{ if(idx>0){ idx--; updateUI(); } });
    nextBtn.addEventListener('click', ()=>{ if(idx<total-1){ idx++; updateUI(); } else { computeResults(); } });

    function choosePersona({visitReason, schoolFeeling, learnPlayStyle, curiositySpark, challengeResponse, aiImportance}){
      if(schoolFeeling==='StrugglesConfidence' || visitReason==='NeedsConfidenceFocus') return 'The Confident Pathfinder';
      if((learnPlayStyle==='HandsOnBuilder' && challengeResponse==='KeepsTrying') || curiositySpark==='BuildingEngineering') return 'The Focused Builder';
      if(curiositySpark==='AIFutureTech' || visitReason==='AIChange' || aiImportance==='VeryEssential') return 'The Innovative Explorer';
      if(learnPlayStyle==='GamerCompetitive') return 'The Competitive Strategist';
      if(learnPlayStyle==='SocialCollaborative') return 'The Collaborative Maker';
      if(learnPlayStyle==='CreativeInventive' || curiositySpark==='StorytellingAnimation') return 'The Inventive Explorer';
      return 'The Curious Creator';
    }

    function phraseGrowthTargets(list){
      if(!list || !list.length) return '';
      const map = {ConfidenceIndependence:'confidence and independence',FocusPersistence:'focus and persistence',ProblemSolvingLogic:'problem-solving and logic',CreativityImagination:'creativity and imagination',FriendshipsTeamwork:'friendships and teamwork'};
      const words = list.map(v=>map[v]||v);
      if(words.length===1) return words[0];
      return words.slice(0,-1).join(', ') + ' and ' + words.slice(-1);
    }

    // Get legend text without hidden hints
    function legendForName(name){
      const any = document.querySelector(`input[name="${name}"]`);
      const fs = any ? any.closest('fieldset') : null;
      const leg = fs ? fs.querySelector('legend') : null;
      if(!leg) return name;
      const clone = leg.cloneNode(true);
      clone.querySelectorAll('span').forEach(s=>s.remove());
      return clone.textContent.trim();
    }
    function radioLabel(name){ const el = document.querySelector(`input[name="${name}"]:checked`); if(!el) return ''; const lab = el.closest('label'); return lab ? lab.textContent.trim() : el.value; }
    function checkboxLabels(name){ const els = Array.from(document.querySelectorAll(`input[name="${name}"]:checked`)); return els.map(el=>{ const lab = el.closest('label'); return lab ? lab.textContent.trim() : el.value; }); }

    function buildQASummaryLines(){
      const order = ['age','experience','comfort','interests','learn','hopes','structure','visitReason','schoolFeeling','aiImportance'];
      const lines = [];
      for(const name of order){
        const legend = legendForName(name);
        let answer = '';
        if(['interests','hopes'].includes(name)){ const arr = checkboxLabels(name); if(arr.length) answer = arr.join(', '); }
        else { answer = radioLabel(name); }
        if(answer){ lines.push(`${legend} → ${answer}`); }
      }
      return lines;
    }

    function submitToWeb3Forms({title, persona}){
      try{
        if(submittedToWeb3) return;
        const fullName = `${getFirstName()} ${getLastName()}`.trim();
        const qa = buildQASummaryLines();
        const stamp = new Date().toLocaleString();
        const body = [
          `Parent: ${fullName}`,
          `Location: ${getLocation()}`,
          `Submitted: ${stamp}`,
          '',
          `Recommendation: ${title}`,
          `Persona: ${persona}`,
          '',
          'Answers:',
          ...qa.map(l=>'• '+l)
        ].join('\r\n');

        const readHidden = (n)=> (wfForm.querySelector(`[name="${n}"]`)||{}).value || '';
        const baseSubject = (readHidden('subject') || 'New Ninja Path').trim();
        const fullNameForSubject = (fullName || '').trim();
        const locForSubject = (getLocation() || '').trim();
        const subjectBaseClean = baseSubject.replace(/[: -]*$/,'');
        const subjectWithLoc = locForSubject ? `${subjectBaseClean} for ${locForSubject}` : subjectBaseClean;
        const dynamicSubject = fullNameForSubject ? `${subjectWithLoc}: ${fullNameForSubject}` : subjectWithLoc;
        const fromName = (readHidden('from_name') || 'Code Ninjas Quiz').trim();

        const fd = new FormData();
        fd.append('access_key', readHidden('access_key'));
        fd.append('subject', dynamicSubject);
        fd.append('from_name', fromName);
        fd.append('redirect', readHidden('redirect'));
        fd.append('message', body);

        fetch('https://api.web3forms.com/submit', { method: 'POST', body: fd })
          .then(r=>r.json())
          .then(data=>{ submittedToWeb3 = true; console.log('[Web3Forms] submission ok', data); })
          .catch(err=>{ console.warn('[Web3Forms] submission failed', err); });
      } catch(e){ console.warn('[Web3Forms] unexpected error', e); }
    }

    function computeResults(){
      const fd = new FormData(document.createElement('form'));
      $$('#wizard input').forEach(el=>{ if((el.type==='radio'||el.type==='checkbox') && !el.checked) return; if(el.name) fd.append(el.name, el.value); });
      const age = fd.get('age');
      const exp = parseInt(fd.get('experience')||'3',10);
      const comfort = parseInt(fd.get('comfort')||'3',10);
      const interests = fd.getAll('interests');
      const style = fd.get('gameStyle');
      const learn = fd.get('learn');
      const hopes = fd.getAll('hopes');
      const structure = fd.get('structure');
      const visitReason = fd.get('visitReason');
      const schoolFeeling = fd.get('schoolFeeling');
      const learnPlayStyle = fd.get('learnPlayStyle');
      const challengeResponse = fd.get('challengeResponse');
      const curiositySpark = fd.get('curiositySpark');
      const growthTargets = fd.getAll('growthTargets');
      const techConfidence = fd.get('techConfidence');
      const schoolWish = fd.get('schoolWish');
      const aiImportance = fd.get('aiImportance');

      let jr=0, create=0, academy=0;
      if(age==='5-7'){ jr+=5 } else { create+=4 }
      if(age==='11-14' || age==='15+') academy += (exp>=4?2:1);
      create += (exp>=3?1:0) + (comfort>=3?1:0);
      academy += (exp>=4?2:0) + (comfort>=4?1:0);
      if(learn==='Step-by-step'||learn==='Mentor') create++;
      if(learn==='Independent') academy++;
      if(structure==='Structured') create+=2; if(structure==='Clubs') jr++; if(structure==='Clubs') create--;
      if(interests.includes('GameDev')) create+=2;
      if(interests.includes('Roblox') || interests.includes('RobloxMinecraft')) create++;
      if(interests.includes('Minecraft') || interests.includes('RobloxMinecraft')) jr++;
      if(interests.includes('Robotics')) academy++;
      if(interests.includes('AI')) academy+=2;
      if(style==='Create'||style==='Puzzles') create++;
      if(style==='Explore') jr++;
      if(hopes.includes('LongTerm')) create++;
      if(hopes.includes('Academic')) academy++;
      if(curiositySpark==='AIFutureTech') academy+=2;
      if(curiositySpark==='RoboticsTech') academy+=1;
      if(learnPlayStyle==='HandsOnBuilder') create+=1;
      if(learnPlayStyle==='CreativeInventive') create+=1;
      if(visitReason==='NeedsConfidenceFocus' && age!=='5-7') create+=1;

      const top = [{k:'JR',v:jr},{k:'CREATE',v:create},{k:'ACADEMY',v:academy}].sort((a,b)=>b.v-a.v)[0].k;

      let title='', blurb='', points=[];
      if(top==='JR'){
        title='Recommended: JR Program (Ages 5–7)';
        blurb='Play-based, confidence-building intro to coding and STEM.';
        points=['Visual curriculum with no reading required','Playful activities that build sequencing and problem-solving','Supportive dojo environment with Code Senseis®'];
      } else if(top==='CREATE'){
        title='Recommended: CREATE Program (8+)';
        blurb='Your child sounds like a Creative Ninja — perfect for our CREATE Program, where they’ll build games, learn real coding, and level up from white to black belt!';
        points=['Path from blocks (MakeCode) to JavaScript to C# / Unity','Design, test, and refine projects with mentor support','Earn belts by mastering increasingly complex skills'];
      } else {
        title='Recommended: Academy Path (AI or Robotics)';
        blurb='For ambitious learners ready to dive deeper into advanced STEM topics.';
        points=['Hands-on projects in AI or Robotics','Blend software, hardware, and design to solve problems','Great alongside CREATE for accelerated growth'];
      }

      $('#recTitle').textContent = title;
      $('#recBlurb').textContent = blurb;
      $('#recPoints').innerHTML = points.map(p=>`<li>${p}</li>`).join('');

      const persona = choosePersona({visitReason, schoolFeeling, learnPlayStyle, curiositySpark, challengeResponse, aiImportance});
      const wants = phraseGrowthTargets(growthTargets);
      const reason = (function(v){
        switch(v){
          case 'FutureReady': return 'prepare your child for a future where coding is a core language';
          case 'AIChange': return 'help your child stay ahead as AI reshapes every field';
          case 'LovesGamesTech': return 'channel their love of games and tech into real skills';
          case 'NeedsConfidenceFocus': return 'build lasting confidence and focus';
          default: return 'explore what lights them up';
        }
      })(visitReason);

      const personaTitle = $('#personaTitle');
      const personaBlurb = $('#personaBlurb');
      personaTitle.textContent = `Your Ninja Fit: ${persona}`;

      let aiLine = '';
      if(aiImportance==='VeryEssential') aiLine = ' In a world reshaped by AI and automation, early fluency becomes a lifelong advantage.';
      else if(aiImportance==='SomewhatComing') aiLine = ' With AI accelerating, a steady head start now pays off later.';

      let confidenceLine = '';
      if(schoolFeeling==='StrugglesConfidence' || visitReason==='NeedsConfidenceFocus'){
        confidenceLine = ' Our mentor-led dojo is designed to turn hesitation into confidence through small wins and steady encouragement.';
      }

      const valuesLine = wants ? ` You mentioned ${wants} — that’s exactly what we build here.` : '';
      const programLinks = { 'JR': 'https://www.codeninjas.com/jr', 'CREATE': 'https://www.codeninjas.com/create', 'ACADEMY': 'https://www.codeninjas.com/academies' };
      const programLink = programLinks[top] || '#';

      personaBlurb.innerHTML = `Your child’s potential is bigger than a screen — it’s a toolkit for life. You’re here to ${reason}.${aiLine}${confidenceLine}${valuesLine} At Code Ninjas, they’ll turn imagination into real games and projects, supported by mentors who guide them through challenges. Every week they spend coding now builds confidence, literacy, and independence that lasts a lifetime. <strong><a href="${programLink}" target="_blank" rel="noopener">Enroll today</a></strong> to lock in your tour bonus and start their journey.`;

      const statsByProgram = {
        'JR': [ { value: '5–7', label: 'Ages (JR)' }, { value: 'No reading', label: 'Reading required' }, { value: 'Scratch & Blockly', label: 'Kid-friendly platforms' }, { value: 'Sequencing • Loops • Conditionals', label: 'Core concepts' }, { value: '1–2 hrs/wk', label: 'Typical time' }, { value: '≈7–8:1', label: 'Student:Sensei (typical)' } ],
        'CREATE': [ { value: '8–14', label: 'Ages (CREATE)' }, { value: '9 belts', label: 'White → Black' }, { value: '1–2 hrs/wk', label: 'Typical time' }, { value: 'Blocks → JS → C#', label: 'Language progression' }, { value: 'Unity capstone', label: 'Original game at Black Belt' }, { value: '≈7–8:1', label: 'Student:Sensei (typical)' } ],
        'ACADEMY': [ { value: 'AI • Robotics', label: 'Tracks' }, { value: 'Multi-week', label: 'Module length' }, { value: '≈7–8:1', label: 'Student:Sensei (typical)' }, { value: 'LEGO SPIKE • VEX GO • Ozobot', label: 'Typical kits' }, { value: 'Aug 2025', label: 'Launched' } ]
      };
      const stats = $('#stats');
      stats.innerHTML = (statsByProgram[top]||[]).map(s=>`<div class="stat"><h3>${s.value}</h3><p>${s.label}</p></div>`).join('');

      $('#wizard').classList.add('hidden');
      result.style.display='block';
      window.scrollTo({top:0,behavior:'smooth'});

      submitToWeb3Forms({ title, persona });
    }

    $('#retake').addEventListener('click',()=>{ $$('#wizard input[type=radio],#wizard input[type=checkbox]').forEach(i=>i.checked=false); $('#wizard').classList.remove('hidden'); $('#result').style.display='none'; idx=0; updateUI(); window.scrollTo({top:0,behavior:'smooth'}); });
    $('#print').addEventListener('click',()=>window.print());

    (function tests(){
      console.assert(document.querySelector('#parentFirstNameTop'), 'First-name input missing');
      console.assert(['JR','CREATE','ACADEMY'].every(k=>k), 'Program keys present');
      console.log('[OK] Sanity checks passed');
    })();

  })();
  </script>

  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('./sw.js').catch(function(){});
    }
  </script>
</body>
</html>
